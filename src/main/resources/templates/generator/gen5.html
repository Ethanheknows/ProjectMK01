<!DOCTYPE html>
<html>
  <head>
    <title>gen5</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/mdbassit/Coloris@latest/dist/coloris.min.css"
    />

    <script src="https://cdn.jsdelivr.net/gh/mdbassit/Coloris@latest/dist/coloris.min.js"></script>
  </head>
  <body>
    <h1>gen5</h1>
    <input type="file" id="fileInput" />
    <br /><br />
    <canvas id="canvas" width="500" height="500"></canvas>
    <br /><br />
    <label for="topRange">Top Position:</label>
    <input type="range" id="topRange" min="0" max="500" step="1" value="0" />
    <br /><br />
    <label for="leftRange">Left Position:</label>
    <input type="range" id="leftRange" min="0" max="500" step="1" value="0" />
    <br /><br />
    <label for="txtBox">Text:</label>
    <input type="text" id="txtBox" />
    <br /><br />
    <label for="fontSizeRange">Font Size:</label>
    <input
      type="range"
      id="fontSizeRange"
      min="1"
      max="72"
      step="1"
      value="36"
    />
    <br /><br />
    <label for="fontColor">Font Color:</label>
    <input type="text" id="fontColor" value="#ffffff" data-coloris />

    <br /><br />
    <label for="fontFamilySelect">Font Family:</label>
    <select id="fontFamilySelect">
      <option value="sans-serif">Sans-serif</option>
      <option value="serif">Serif</option>
      <option value="monospace">Monospace</option>
    </select>
    <br /><br />
    <a id="downloadLink" download="meme.png" href="#" style="display: none"
      >Download Meme</a
    >
    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      const fileInput = document.getElementById("fileInput");
      const topRange = document.getElementById("topRange");
      const leftRange = document.getElementById("leftRange");
      const txtBox = document.getElementById("txtBox");
      const generateBtn = document.getElementById("generateBtn");
      const downloadLink = document.getElementById("downloadLink");
      let colorPicker = document.querySelector("#fontColor");
      let img = null;

      Coloris({
        parent: ".demo",
        theme: "default", //default, large, polaroid, pill
        themeMode: "light", //light , dark 모드
        margin: 2, //입력 필드와 색선택시 사이 여백
        alpha: true, //불투명도 조절
        format: "hex", //포맷  hex rgb hsl auto mixed
        formatToggle: false, //포맷 토글
        clearButton: true,
        clearLabel: "Clear",
        swatches: [
          "#264653",
          "#2a9d8f",
          "#e9c46a",
          "rgb(244,162,97)",
          "#e76f51",
          "#d62828",
          "navy",
          "#07b",
          "#0096c7",
          "#00b4d880",
          "rgba(0,119,182,0.8)",
        ],
        inline: false,
        defaultColor: "#000000",
      });
      fileInput.addEventListener("change", () => {
        const reader = new FileReader();
        reader.onload = () => {
          img = new Image();
          img.onload = () => {
            let ratio = img.width / img.height;
            if (ratio > 1) {
              canvas.width = 500;
              canvas.height = 500 / ratio;
            } else {
              canvas.width = 500 * ratio;
              canvas.height = 500;
            }
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
          };
          img.src = reader.result;
        };
        reader.readAsDataURL(fileInput.files[0]);
      });

      let defaultColor = "#ffffff";
      let fontColorPicked = defaultColor;

      window.addEventListener("load", startup, false);

      function startup() {
        colorPicker.value = defaultColor;
        colorPicker.addEventListener("input", updateColor, false);
        colorPicker.select();
      }
      function updateColor(event) {
        fontColorPicked = event.target.value;
      }
      function drawCanvas() {
        if (img !== null) {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
          ctx.fillStyle = fontColorPicked;
          ctx.font = "bold 36px sans-serif";
          ctx.textAlign = "center";
          ctx.fillText(
            txtBox.value,
            canvas.width / 2 + parseInt(leftRange.value),
            parseInt(topRange.value) + 36
          );
          downloadLink.href = canvas.toDataURL();
          downloadLink.style.display = "block";
        }
      }
      txtBox.addEventListener("input", drawCanvas, false);
      topRange.addEventListener("input", drawCanvas, false);
      leftRange.addEventListener("input", drawCanvas, false);
      colorPicker.addEventListener("input", drawCanvas, false);
    </script>
  </body>
</html>
